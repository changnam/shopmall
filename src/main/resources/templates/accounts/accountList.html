<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link th:href="@{/css/bootstrap.min.css}" rel="stylesheet">
</head>
<body th:inline="text">
	<div class="container mx-5">
	   <th:block th:replace="~{/module/header}"></th:block>
	   
		<table class="table table-boarded table-striped">
			<h2>account list</h2>
			<thead class="table-dark">
				<tr>
					<th th:text="#{label.name}"></th>
					<th th:text="#{label.email}"></th>
					<th th:text="#{label.role}"></th>
					<th>Actions</th>				<!-- New column -->
					<th>popup action</th>
				</tr>
			</thead>
			<tbody>
				<tr th:each="account : ${accounts}">
					<td th:text="${account.nickname}"></td>
					<td th:text="${account.email}"></td>
					<td><span th:each="role : ${account.roles}"
						class="badge bg-primary me-1" th:text="${role.erole}">ROLE</span>
					</td>
					<td><a th:href="@{'/accounts/edit/' + ${account.accountId}}"
						class="btn btn-sm btn-warning"> Edit </a></td>
		            <td>
		                <button type="button"
					        class="btn btn-sm btn-warning edit-btn"
					        data-bs-toggle="modal"
					        data-bs-target="#editModal"
					        th:attr="data-id=${account.accountId}, 
					                 data-nickname=${account.nickname}, 
					                 data-email=${account.email}">
					    Edit
					</button>
		            </td>
            
				</tr>
			</tbody>
		</table>
<nav class="centered mt-4">
  <ul class="pagination justify-content-center">

    <!-- First Page -->
    <li class="page-item" th:classappend="${page.first} ? ' disabled'">
      <a class="page-link" th:href="@{/accounts(page=0, size=${page.size})}">First</a>
    </li>

    <!-- Previous Page -->
    <li class="page-item" th:classappend="${page.first} ? ' disabled'">
      <a class="page-link" th:href="@{/accounts(page=${page.number - 1}, size=${page.size})}">Previous</a>
    </li>

    <!-- Page Numbers (centered around current page) -->
    <li class="page-item"
        th:each="i : ${#numbers.sequence(
            T(java.lang.Math).max(0, page.number - 2),
            T(java.lang.Math).min(page.totalPages - 1, page.number + 2)
        )}"
        th:classappend="${i == page.number} ? ' active'">
      <a class="page-link" th:href="@{/accounts(page=${i}, size=${page.size})}" th:text="${i + 1}">1</a>
    </li>

    <!-- Next Page -->
    <li class="page-item" th:classappend="${page.last} ? ' disabled'">
      <a class="page-link" th:href="@{/accounts(page=${page.number + 1}, size=${page.size})}">Next</a>
    </li>

    <!-- Last Page -->
    <li class="page-item" th:classappend="${page.last} ? ' disabled'">
      <a class="page-link" th:href="@{/accounts(page=${page.totalPages - 1}, size=${page.size})}">Last</a>
    </li>
  </ul>

  <!-- Page Info -->
  <div class="text-center mt-2">
    Page <span th:text="${page.number + 1}"></span> of <span th:text="${page.totalPages}"></span>,
    Total Items: <span th:text="${page.totalElements}"></span>
  </div>
</nav>

		    
		  </ul>
		  
		  
		</nav>

        <th:block th:replace="~{/module/footer}"></th:block>
	</div>
	
	<div class="modal fade" id="editModal" tabindex="-1">
	  <div class="modal-dialog">
	    <form class="modal-content" method="post">
	      <div class="modal-header">
	        <h5 class="modal-title">Edit Account</h5>
	        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
	      </div>
	
	      <div class="modal-body">
	          <input type="hidden" name="id" id="acc-id">
	
	          <div class="mb-3">
	              <label class="form-label" for="acc-nickname" th:text="#{label.name}">Name</label>
	              <input class="form-control" type="text"  name="nickname" id="acc-nickname">
	          </div>
	
	          <div class="mb-3">
	              <label class="form-label" for="acc-email" th:text="#{label.email}">Email</label>
	              <input class="form-control" type="email" name="email" id="acc-email">
	          </div>
	      </div>
	
	      <div class="modal-footer">
	        <button type="submit" class="btn btn-primary">Save</button>
	        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
	      </div>
	    </form>
	  </div>
	</div>
	
	<script th:src="@{/js/bootstrap.bundle.min.js}"></script>
<script>
  const editModal  = document.getElementById('editModal');
  const idInput    = document.getElementById('acc-id');
  const nickInput  = document.getElementById('acc-nickname');
  const emailInput = document.getElementById('acc-email');
  const form       = editModal.querySelector('form');

  // Fired every time a .edit‑btn opens the modal
  editModal.addEventListener('show.bs.modal', event => {
      const btn = event.relatedTarget;        // button that triggered the modal

      // Pull values out of data-* attributes
      const id       = btn.getAttribute('data-id');
      const nickname = btn.getAttribute('data-nickname');
      const email    = btn.getAttribute('data-email');

      // Pre‑fill the form fields
      idInput.value       = id;
      nickInput.value     = nickname;
      emailInput.value    = email;

      // Point the form at /accounts/edit/{id}
      form.action = `/accounts/edit/${id}`;
  });
</script>

	
</body>
</html>