<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link th:href="@{/css/bootstrap.min.css}" rel="stylesheet">
</head>
<body th:inline="text">
	<h1>account list</h1>
	<div class="container mx-5">
		<table class="table table-boarded table-striped">
			<h2>account list</h2>
			<thead class="table-dark">
				<tr>
					<th th:text="#{label.name}"></th>
					<th th:text="#{label.email}"></th>
					<th th:text="#{label.role}"></th>
					<th>Actions</th>				<!-- New column -->
					<th>popup action</th>
				</tr>
			</thead>
			<tbody>
				<tr th:each="account : ${accounts}">
					<td th:text="${account.nickname}"></td>
					<td th:text="${account.email}"></td>
					<td><span th:each="role : ${account.roles}"
						class="badge bg-primary me-1" th:text="${role.erole}">ROLE</span>
					</td>
					<td><a th:href="@{'/accounts/edit/' + ${account.accountId}}"
						class="btn btn-sm btn-warning"> Edit </a></td>
		            <td>
		                <button type="button"
					        class="btn btn-sm btn-warning edit-btn"
					        data-bs-toggle="modal"
					        data-bs-target="#editModal"
					        th:attr="data-id=${account.accountId}, 
					                 data-nickname=${account.nickname}, 
					                 data-email=${account.email}">
					    Edit
					</button>
		            </td>
            
				</tr>
			</tbody>
		</table>
	</div>
	
	<div class="modal fade" id="editModal" tabindex="-1">
  <div class="modal-dialog">
    <form class="modal-content" method="post">
      <div class="modal-header">
        <h5 class="modal-title">Edit Account</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
          <input type="hidden" name="id" id="acc-id">

          <div class="mb-3">
              <label class="form-label" for="acc-nickname" th:text="#{label.name}">Name</label>
              <input class="form-control" type="text"  name="nickname" id="acc-nickname">
          </div>

          <div class="mb-3">
              <label class="form-label" for="acc-email" th:text="#{label.email}">Email</label>
              <input class="form-control" type="email" name="email" id="acc-email">
          </div>
      </div>

      <div class="modal-footer">
        <button type="submit" class="btn btn-primary">Save</button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
      </div>
    </form>
  </div>
</div>
	
	<script th:src="@{/js/bootstrap.bundle.min.js}"></script>
<script>
  const editModal  = document.getElementById('editModal');
  const idInput    = document.getElementById('acc-id');
  const nickInput  = document.getElementById('acc-nickname');
  const emailInput = document.getElementById('acc-email');
  const form       = editModal.querySelector('form');

  // Fired every time a .edit‑btn opens the modal
  editModal.addEventListener('show.bs.modal', event => {
      const btn = event.relatedTarget;        // button that triggered the modal

      // Pull values out of data-* attributes
      const id       = btn.getAttribute('data-id');
      const nickname = btn.getAttribute('data-nickname');
      const email    = btn.getAttribute('data-email');

      // Pre‑fill the form fields
      idInput.value       = id;
      nickInput.value     = nickname;
      emailInput.value    = email;

      // Point the form at /accounts/edit/{id}
      form.action = `/accounts/edit/${id}`;
  });
</script>

	
</body>
</html>