<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link th:href="@{/css/bootstrap.min.css}" rel="stylesheet">
</head>
<body th:inline="text">
	<div class="container mx-5">
	   <th:block th:replace="~{/module/header}"></th:block>
	   
		<table class="table table-boarded table-striped">
			<h2>account list</h2>
			<thead class="table-dark">
			  <tr>
			    <!-- Nickname Sorting -->
			    <th th:with="nextDir=${sortField} == 'nickname' and ${sortDir} == 'asc' ? 'desc' : 'asc'">
			      <a th:href="@{/accounts(page=0, size=${page.size}, sort='nickname,' + ${nextDir})}"
			         th:text="'Name' + (${sortField} == 'nickname' ? (${sortDir} == 'asc' ? ' ▲' : ' ▼') : '')">
			         Name
			      </a>
			    </th>
			
			    <!-- Email Sorting -->
			    <th th:with="nextDir=${sortField} == 'email' and ${sortDir} == 'asc' ? 'desc' : 'asc'">
			      <a th:href="@{/accounts(page=0, size=${page.size}, sort='email,' + ${nextDir})}"
			         th:text="'Email' + (${sortField} == 'email' ? (${sortDir} == 'asc' ? ' ▲' : ' ▼') : '')">
			         Email
			      </a>
			    </th>
			
			    <!-- Role Sorting -->
			    <th th:with="nextDir=${sortField} == 'roles' and ${sortDir} == 'asc' ? 'desc' : 'asc'">
			      <a th:href="@{/accounts(page=0, size=${page.size}, sort='roles,' + ${nextDir})}"
			         th:text="'Role' + (${sortField} == 'roles' ? (${sortDir} == 'asc' ? ' ▲' : ' ▼') : '')">
			         Role
			      </a>
			    </th>
			
			    <!-- Actions Columns (no sort) -->
			    <th>Actions</th>
			    <th>Popup Action</th>
			  </tr>
			</thead>

			<tbody>
				<tr th:each="account : ${accounts}">
					<td th:text="${account.nickname}"></td>
					<td th:text="${account.email}"></td>
					<td><span th:each="role : ${account.roles}"
						class="badge bg-primary me-1" th:text="${role.erole}">ROLE</span>
					</td>
					<td><a th:href="@{'/accounts/edit/' + ${account.accountId}}"
						class="btn btn-sm btn-warning"> Edit </a></td>
		            <td>
		                <button type="button"
					        class="btn btn-sm btn-warning edit-btn"
					        data-bs-toggle="modal"
					        data-bs-target="#editModal"
					        th:attr="data-id=${account.accountId}, 
					                 data-nickname=${account.nickname}, 
					                 data-email=${account.email}">
					    Edit
					</button>
		            </td>
            
				</tr>
			</tbody>
		</table>
<!-- Pagination Bar -->
<nav class="centered mt-4">
  <ul class="pagination justify-content-center">

    <!-- First Page -->
    <li class="page-item" th:classappend="${page.first} ? ' disabled'">
      <a class="page-link" th:href="@{/accounts(page=0, size=${page.size}, sort=${sort})}">First</a>
    </li>

    <!-- Previous -->
    <li class="page-item" th:classappend="${page.first} ? ' disabled'">
      <a class="page-link" th:href="@{/accounts(page=${page.number - 1}, size=${page.size}, sort=${sort})}">Previous</a>
    </li>

    <!-- Page Numbers (limit 5) -->
    <li class="page-item"
        th:each="i : ${#numbers.sequence(
            T(java.lang.Math).max(0, page.number - 2),
            T(java.lang.Math).min(page.totalPages - 1, page.number + 2)
        )}"
        th:classappend="${i == page.number} ? ' active'">
      <a class="page-link"
         th:href="@{/accounts(page=${i}, size=${page.size}, sort=${sort})}"
         th:text="${i + 1}">1</a>
    </li>

    <!-- Next -->
    <li class="page-item" th:classappend="${page.last} ? ' disabled'">
      <a class="page-link" th:href="@{/accounts(page=${page.number + 1}, size=${page.size}, sort=${sort})}">Next</a>
    </li>

    <!-- Last -->
    <li class="page-item" th:classappend="${page.last} ? ' disabled'">
      <a class="page-link" th:href="@{/accounts(page=${page.totalPages - 1}, size=${page.size}, sort=${sort})}">Last</a>
    </li>
  </ul>

  <!-- Page Info -->
  <div class="text-center mt-2">
    Page <span th:text="${page.number + 1}"></span> of <span th:text="${page.totalPages}"></span> |
    Total Items: <span th:text="${page.totalElements}"></span>
  </div>

  <!-- Page Size Dropdown -->
  <div class="text-center mt-3">
    <form method="get" th:action="@{/accounts}">
      <input type="hidden" name="page" th:value="${page.number}" />
      <input type="hidden" name="sort" th:value="${sort}" />
      <label for="size">Items per page:</label>
      <select name="size" id="size" onchange="this.form.submit()">
        <option th:value="5" th:selected="${page.size == 5}">5</option>
        <option th:value="10" th:selected="${page.size == 10}">10</option>
        <option th:value="20" th:selected="${page.size == 20}">20</option>
        <option th:value="50" th:selected="${page.size == 50}">50</option>
      </select>
    </form>
  </div>
</nav>

        <th:block th:replace="~{/module/footer}"></th:block>
	</div>
	
	<div class="modal fade" id="editModal" tabindex="-1">
	  <div class="modal-dialog">
	    <form class="modal-content" method="post">
	      <div class="modal-header">
	        <h5 class="modal-title">Edit Account</h5>
	        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
	      </div>
	
	      <div class="modal-body">
	          <input type="hidden" name="id" id="acc-id">
	
	          <div class="mb-3">
	              <label class="form-label" for="acc-nickname" th:text="#{label.name}">Name</label>
	              <input class="form-control" type="text"  name="nickname" id="acc-nickname">
	          </div>
	
	          <div class="mb-3">
	              <label class="form-label" for="acc-email" th:text="#{label.email}">Email</label>
	              <input class="form-control" type="email" name="email" id="acc-email">
	          </div>
	      </div>
	
	      <div class="modal-footer">
	        <button type="submit" class="btn btn-primary">Save</button>
	        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
	      </div>
	    </form>
	  </div>
	</div>
	
	<script th:src="@{/js/bootstrap.bundle.min.js}"></script>
<script>
  const editModal  = document.getElementById('editModal');
  const idInput    = document.getElementById('acc-id');
  const nickInput  = document.getElementById('acc-nickname');
  const emailInput = document.getElementById('acc-email');
  const form       = editModal.querySelector('form');

  // Fired every time a .edit‑btn opens the modal
  editModal.addEventListener('show.bs.modal', event => {
      const btn = event.relatedTarget;        // button that triggered the modal

      // Pull values out of data-* attributes
      const id       = btn.getAttribute('data-id');
      const nickname = btn.getAttribute('data-nickname');
      const email    = btn.getAttribute('data-email');

      // Pre‑fill the form fields
      idInput.value       = id;
      nickInput.value     = nickname;
      emailInput.value    = email;

      // Point the form at /accounts/edit/{id}
      form.action = `/accounts/edit/${id}`;
  });
</script>

	
</body>
</html>